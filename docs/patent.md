## Система патентов

Необходима для подтверждения владения вами городов, структур, и т.д.


### Пути к модулям системы

- /bll/reducers/users.py
- /modules/patent.py
- /storage/patent.py
- /ui/pages/patent.py


### Необходимые требования

- Для регистации патента:
  - зарегестрировать своего персонажа в /storage/users/, если вас там нет


> [!NOTE]
> под state в данной документации подразумевается state в /bll/reducers/users.py


### Регистрация (создание) патента
#### Терминология, не связанная с системой патентов

- `user_name` - ваше имя на HaypLand
- `user_pass` - пароль вашей учётной записи на HaypLand


#### Использование

Чтобы попасть на страницу системы патентов введите `рег ап`. Для создания патента введите через пробел свой `user_name` 
и `user_pass`. На экран вам выведется промежуточный хеш (mw_hash, от middle-ware). Cкопируйте его. В файле /storage/patent/
добавьте следующий код в функцию create_patents:

```python
create_patent_action(user_name, mw_hash, description)
```

где:
- user_name (str) - ваш user_name
- mw_hash (str) - скопированный ранее промежуточный хеш
- description (str) - содержание патента


####  Принцип работы (краткое описание)

1. Проверяется истинность входных данных с помощью функции `is_user_valid_action`. Результат выполнения функции сохраняется в `state['is_user_valid']`.

2. Проверяется истинность истории патентов. Она хранится в `state['is_chain_valid']`. Если история истина, то:
   1. Вычисляется mw_hash функцией `calculate_mw_hash_action` с помощью криптографической хеш-функции sha3-256, поставляемой библиотекой hashlib. mw_hash зависит от user_name и user_pass
    
   2. После того, как пользователь зарегестрировал патент в /storage/patent, в `state[user_name]['patent_chain']` добавляется так называемый блок (объект), содержащий:
        
      - hash (str) - хеш текущего блока
      - previous_hash (str) - хеш предыдущего блока
      - desc (str) - содержание патента
        
      hash текущего блока вычисляется функцией `calculate_hash`. Он зависит от mw_hash, previous_hash и desc.


### Обработка ошибок

- Если user_name нет в объекте users, или user_pass не соответствует user_name
`ERR: Неверные данные пользователя`

- Невалидный формат входных данных
`ERR: Несуществующая команда или невалидный формат входных данных`

- История патентов не истинна
`ERR: Ваша история патентов кем-то изменена. Чтобы продолжить работать с системой патентов, обратитесь к администрации HaypLand`

При появлении выше описанных ошибок работоспособность системы патентов не нарушится.
